import{t as tt}from"./main-q2aOKx0S.js";function et(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var G={exports:{}},ut=G.exports,st;function dt(){return st||(st=1,function(s,l){(function(h,b){s.exports=b()})(ut,function(){var h=1e3,b=6e4,_=36e5,g="millisecond",v="second",S="minute",u="hour",f="day",M="week",$="month",m="quarter",w="year",d="date",r="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,L=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,C={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(i){var n=["th","st","nd","rd"],t=i%100;return"["+i+(n[(t-20)%10]||n[t]||n[0])+"]"}},O=function(i,n,t){var o=String(i);return!o||o.length>=n?i:""+Array(n+1-o.length).join(t)+i},z={s:O,z:function(i){var n=-i.utcOffset(),t=Math.abs(n),o=Math.floor(t/60),e=t%60;return(n<=0?"+":"-")+O(o,2,"0")+":"+O(e,2,"0")},m:function i(n,t){if(n.date()<t.date())return-i(t,n);var o=12*(t.year()-n.year())+(t.month()-n.month()),e=n.clone().add(o,$),a=t-e<0,c=n.clone().add(o+(a?-1:1),$);return+(-(o+(t-e)/(a?e-c:c-e))||0)},a:function(i){return i<0?Math.ceil(i)||0:Math.floor(i)},p:function(i){return{M:$,y:w,w:M,d:f,D:d,h:u,m:S,s:v,ms:g,Q:m}[i]||String(i||"").toLowerCase().replace(/s$/,"")},u:function(i){return i===void 0}},x="en",E={};E[x]=C;var Y="$isDayjsObject",A=function(i){return i instanceof R||!(!i||!i[Y])},q=function i(n,t,o){var e;if(!n)return x;if(typeof n=="string"){var a=n.toLowerCase();E[a]&&(e=a),t&&(E[a]=t,e=a);var c=n.split("-");if(!e&&c.length>1)return i(c[0])}else{var D=n.name;E[D]=n,e=D}return!o&&e&&(x=e),e||!o&&x},T=function(i,n){if(A(i))return i.clone();var t=typeof n=="object"?n:{};return t.date=i,t.args=arguments,new R(t)},y=z;y.l=q,y.i=A,y.w=function(i,n){return T(i,{locale:n.$L,utc:n.$u,x:n.$x,$offset:n.$offset})};var R=function(){function i(t){this.$L=q(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[Y]=!0}var n=i.prototype;return n.parse=function(t){this.$d=function(o){var e=o.date,a=o.utc;if(e===null)return new Date(NaN);if(y.u(e))return new Date;if(e instanceof Date)return new Date(e);if(typeof e=="string"&&!/Z$/i.test(e)){var c=e.match(p);if(c){var D=c[2]-1||0,k=(c[7]||"0").substring(0,3);return a?new Date(Date.UTC(c[1],D,c[3]||1,c[4]||0,c[5]||0,c[6]||0,k)):new Date(c[1],D,c[3]||1,c[4]||0,c[5]||0,c[6]||0,k)}}return new Date(e)}(t),this.init()},n.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},n.$utils=function(){return y},n.isValid=function(){return this.$d.toString()!==r},n.isSame=function(t,o){var e=T(t);return this.startOf(o)<=e&&e<=this.endOf(o)},n.isAfter=function(t,o){return T(t)<this.startOf(o)},n.isBefore=function(t,o){return this.endOf(o)<T(t)},n.$g=function(t,o,e){return y.u(t)?this[o]:this.set(e,t)},n.unix=function(){return Math.floor(this.valueOf()/1e3)},n.valueOf=function(){return this.$d.getTime()},n.startOf=function(t,o){var e=this,a=!!y.u(o)||o,c=y.p(t),D=function(B,U){var I=y.w(e.$u?Date.UTC(e.$y,U,B):new Date(e.$y,U,B),e);return a?I:I.endOf(f)},k=function(B,U){return y.w(e.toDate()[B].apply(e.toDate("s"),(a?[0,0,0,0]:[23,59,59,999]).slice(U)),e)},H=this.$W,j=this.$M,N=this.$D,P="set"+(this.$u?"UTC":"");switch(c){case w:return a?D(1,0):D(31,11);case $:return a?D(1,j):D(0,j+1);case M:var F=this.$locale().weekStart||0,W=(H<F?H+7:H)-F;return D(a?N-W:N+(6-W),j);case f:case d:return k(P+"Hours",0);case u:return k(P+"Minutes",1);case S:return k(P+"Seconds",2);case v:return k(P+"Milliseconds",3);default:return this.clone()}},n.endOf=function(t){return this.startOf(t,!1)},n.$set=function(t,o){var e,a=y.p(t),c="set"+(this.$u?"UTC":""),D=(e={},e[f]=c+"Date",e[d]=c+"Date",e[$]=c+"Month",e[w]=c+"FullYear",e[u]=c+"Hours",e[S]=c+"Minutes",e[v]=c+"Seconds",e[g]=c+"Milliseconds",e)[a],k=a===f?this.$D+(o-this.$W):o;if(a===$||a===w){var H=this.clone().set(d,1);H.$d[D](k),H.init(),this.$d=H.set(d,Math.min(this.$D,H.daysInMonth())).$d}else D&&this.$d[D](k);return this.init(),this},n.set=function(t,o){return this.clone().$set(t,o)},n.get=function(t){return this[y.p(t)]()},n.add=function(t,o){var e,a=this;t=Number(t);var c=y.p(o),D=function(j){var N=T(a);return y.w(N.date(N.date()+Math.round(j*t)),a)};if(c===$)return this.set($,this.$M+t);if(c===w)return this.set(w,this.$y+t);if(c===f)return D(1);if(c===M)return D(7);var k=(e={},e[S]=b,e[u]=_,e[v]=h,e)[c]||1,H=this.$d.getTime()+t*k;return y.w(H,this)},n.subtract=function(t,o){return this.add(-1*t,o)},n.format=function(t){var o=this,e=this.$locale();if(!this.isValid())return e.invalidDate||r;var a=t||"YYYY-MM-DDTHH:mm:ssZ",c=y.z(this),D=this.$H,k=this.$m,H=this.$M,j=e.weekdays,N=e.months,P=e.meridiem,F=function(U,I,Z,V){return U&&(U[I]||U(o,a))||Z[I].slice(0,V)},W=function(U){return y.s(D%12||12,U,"0")},B=P||function(U,I,Z){var V=U<12?"AM":"PM";return Z?V.toLowerCase():V};return a.replace(L,function(U,I){return I||function(Z){switch(Z){case"YY":return String(o.$y).slice(-2);case"YYYY":return y.s(o.$y,4,"0");case"M":return H+1;case"MM":return y.s(H+1,2,"0");case"MMM":return F(e.monthsShort,H,N,3);case"MMMM":return F(N,H);case"D":return o.$D;case"DD":return y.s(o.$D,2,"0");case"d":return String(o.$W);case"dd":return F(e.weekdaysMin,o.$W,j,2);case"ddd":return F(e.weekdaysShort,o.$W,j,3);case"dddd":return j[o.$W];case"H":return String(D);case"HH":return y.s(D,2,"0");case"h":return W(1);case"hh":return W(2);case"a":return B(D,k,!0);case"A":return B(D,k,!1);case"m":return String(k);case"mm":return y.s(k,2,"0");case"s":return String(o.$s);case"ss":return y.s(o.$s,2,"0");case"SSS":return y.s(o.$ms,3,"0");case"Z":return c}return null}(U)||c.replace(":","")})},n.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},n.diff=function(t,o,e){var a,c=this,D=y.p(o),k=T(t),H=(k.utcOffset()-this.utcOffset())*b,j=this-k,N=function(){return y.m(c,k)};switch(D){case w:a=N()/12;break;case $:a=N();break;case m:a=N()/3;break;case M:a=(j-H)/6048e5;break;case f:a=(j-H)/864e5;break;case u:a=j/_;break;case S:a=j/b;break;case v:a=j/h;break;default:a=j}return e?a:y.a(a)},n.daysInMonth=function(){return this.endOf($).$D},n.$locale=function(){return E[this.$L]},n.locale=function(t,o){if(!t)return this.$L;var e=this.clone(),a=q(t,o,!0);return a&&(e.$L=a),e},n.clone=function(){return y.w(this.$d,this)},n.toDate=function(){return new Date(this.valueOf())},n.toJSON=function(){return this.isValid()?this.toISOString():null},n.toISOString=function(){return this.$d.toISOString()},n.toString=function(){return this.$d.toUTCString()},i}(),rt=R.prototype;return T.prototype=rt,[["$ms",g],["$s",v],["$m",S],["$H",u],["$W",f],["$M",$],["$y",w],["$D",d]].forEach(function(i){rt[i[1]]=function(n){return this.$g(n,i[0],i[1])}}),T.extend=function(i,n){return i.$i||(i(n,R,T),i.$i=!0),T},T.locale=q,T.isDayjs=A,T.unix=function(i){return T(1e3*i)},T.en=E[x],T.Ls=E,T.p={},T})}(G)),G.exports}var lt=dt();const J=et(lt);var Q={exports:{}},ft=Q.exports,ot;function mt(){return ot||(ot=1,function(s,l){(function(h,b){s.exports=b()})(ft,function(){return function(h,b,_){h=h||{};var g=b.prototype,v={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function S(f,M,$,m){return g.fromToBase(f,M,$,m)}_.en.relativeTime=v,g.fromToBase=function(f,M,$,m,w){for(var d,r,p,L=$.$locale().relativeTime||v,C=h.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],O=C.length,z=0;z<O;z+=1){var x=C[z];x.d&&(d=m?_(f).diff($,x.d,!0):$.diff(f,x.d,!0));var E=(h.rounding||Math.round)(Math.abs(d));if(p=d>0,E<=x.r||!x.r){E<=1&&z>0&&(x=C[z-1]);var Y=L[x.l];w&&(E=w(""+E)),r=typeof Y=="string"?Y.replace("%d",E):Y(E,M,x.l,p);break}}if(M)return r;var A=p?L.future:L.past;return typeof A=="function"?A(r):A.replace("%s",r)},g.to=function(f,M){return S(f,M,this,!0)},g.from=function(f,M){return S(f,M,this)};var u=function(f){return f.$u?_.utc():_()};g.toNow=function(f){return this.to(u(this),f)},g.fromNow=function(f){return this.from(u(this),f)}}})}(Q)),Q.exports}var ht=mt();const vt=et(ht);var K={exports:{}},$t=K.exports,it;function pt(){return it||(it=1,function(s,l){(function(h,b){s.exports=b()})($t,function(){var h="minute",b=/[+-]\d\d(?::?\d\d)?/g,_=/([+-]|\d\d)/g;return function(g,v,S){var u=v.prototype;S.utc=function(r){var p={date:r,utc:!0,args:arguments};return new v(p)},u.utc=function(r){var p=S(this.toDate(),{locale:this.$L,utc:!0});return r?p.add(this.utcOffset(),h):p},u.local=function(){return S(this.toDate(),{locale:this.$L,utc:!1})};var f=u.parse;u.parse=function(r){r.utc&&(this.$u=!0),this.$utils().u(r.$offset)||(this.$offset=r.$offset),f.call(this,r)};var M=u.init;u.init=function(){if(this.$u){var r=this.$d;this.$y=r.getUTCFullYear(),this.$M=r.getUTCMonth(),this.$D=r.getUTCDate(),this.$W=r.getUTCDay(),this.$H=r.getUTCHours(),this.$m=r.getUTCMinutes(),this.$s=r.getUTCSeconds(),this.$ms=r.getUTCMilliseconds()}else M.call(this)};var $=u.utcOffset;u.utcOffset=function(r,p){var L=this.$utils().u;if(L(r))return this.$u?0:L(this.$offset)?$.call(this):this.$offset;if(typeof r=="string"&&(r=function(x){x===void 0&&(x="");var E=x.match(b);if(!E)return null;var Y=(""+E[0]).match(_)||["-",0,0],A=Y[0],q=60*+Y[1]+ +Y[2];return q===0?0:A==="+"?q:-q}(r),r===null))return this;var C=Math.abs(r)<=16?60*r:r,O=this;if(p)return O.$offset=C,O.$u=r===0,O;if(r!==0){var z=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(O=this.local().add(C+z,h)).$offset=C,O.$x.$localOffset=z}else O=this.utc();return O};var m=u.format;u.format=function(r){var p=r||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return m.call(this,p)},u.valueOf=function(){var r=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*r},u.isUTC=function(){return!!this.$u},u.toISOString=function(){return this.toDate().toISOString()},u.toString=function(){return this.toDate().toUTCString()};var w=u.toDate;u.toDate=function(r){return r==="s"&&this.$offset?S(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():w.call(this)};var d=u.diff;u.diff=function(r,p,L){if(r&&this.$u===r.$u)return d.call(this,r,p,L);var C=this.local(),O=S(r).local();return d.call(C,O,p,L)}}})}(K)),K.exports}var yt=pt();const bt=et(yt);var X={exports:{}},gt=X.exports,at;function wt(){return at||(at=1,function(s,l){(function(h,b){s.exports=b()})(gt,function(){var h={year:0,month:1,day:2,hour:3,minute:4,second:5},b={};return function(_,g,v){var S,u=function(m,w,d){d===void 0&&(d={});var r=new Date(m),p=function(L,C){C===void 0&&(C={});var O=C.timeZoneName||"short",z=L+"|"+O,x=b[z];return x||(x=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:L,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:O}),b[z]=x),x}(w,d);return p.formatToParts(r)},f=function(m,w){for(var d=u(m,w),r=[],p=0;p<d.length;p+=1){var L=d[p],C=L.type,O=L.value,z=h[C];z>=0&&(r[z]=parseInt(O,10))}var x=r[3],E=x===24?0:x,Y=r[0]+"-"+r[1]+"-"+r[2]+" "+E+":"+r[4]+":"+r[5]+":000",A=+m;return(v.utc(Y).valueOf()-(A-=A%1e3))/6e4},M=g.prototype;M.tz=function(m,w){m===void 0&&(m=S);var d,r=this.utcOffset(),p=this.toDate(),L=p.toLocaleString("en-US",{timeZone:m}),C=Math.round((p-new Date(L))/1e3/60),O=15*-Math.round(p.getTimezoneOffset()/15)-C;if(!Number(O))d=this.utcOffset(0,w);else if(d=v(L,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(O,!0),w){var z=d.utcOffset();d=d.add(r-z,"minute")}return d.$x.$timezone=m,d},M.offsetName=function(m){var w=this.$x.$timezone||v.tz.guess(),d=u(this.valueOf(),w,{timeZoneName:m}).find(function(r){return r.type.toLowerCase()==="timezonename"});return d&&d.value};var $=M.startOf;M.startOf=function(m,w){if(!this.$x||!this.$x.$timezone)return $.call(this,m,w);var d=v(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return $.call(d,m,w).tz(this.$x.$timezone,!0)},v.tz=function(m,w,d){var r=d&&w,p=d||w||S,L=f(+v(),p);if(typeof m!="string")return v(m).tz(p);var C=function(E,Y,A){var q=E-60*Y*1e3,T=f(q,A);if(Y===T)return[q,Y];var y=f(q-=60*(T-Y)*1e3,A);return T===y?[q,T]:[E-60*Math.min(T,y)*1e3,Math.max(T,y)]}(v.utc(m,r).valueOf(),L,p),O=C[0],z=C[1],x=v(O).utcOffset(z);return x.$x.$timezone=p,x},v.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},v.tz.setDefault=function(m){S=m}}})}(X)),X.exports}var xt=wt();const Mt=et(xt);J.extend(vt);J.extend(bt);J.extend(Mt);function St(s=[],l=!1){return`
	  <div class="posts-container">
	    ${s.length>0?s.map(h=>Dt(h)).join(""):renderEmptyState(l)}
	  </div>
	`}function Dt(s){const l=J.utc(s.created_at).tz("Asia/Almaty").fromNow();return`
	  <div class="post bg-body" data-post-id="${s.id}">
	    <div class="post-votes bg-body">
	      <button class="vote-btn upvote text-body" aria-label="Upvote">
		<i class="bi bi-arrow-up text-body"></i>
	      </button>
	      <span class="vote-count text-body">${s.votes}</span>
	      <button class="vote-btn downvote text-body" aria-label="Downvote">
		<i class="bi bi-arrow-down text-body"></i>
	      </button>
	    </div>
	    <div class="post-content bg-body">
	      <div class="post-header">
		<span class="post-community text-body">r/${s.community}</span>
		<span class="post-author text-body">Posted by u/${s.author}</span>
		<span class="post-time text-body">${l}</span>
	      </div>
	      <h3 class="post-title text-body">${s.title}</h3>
	      ${s.image?`
		<div class="post-image-container bg-body">
		  <img src="http://localhost:5000/${s.image}" class="post-image" alt="${s.title}">
		</div>
	      `:""}
	      <div class="post-text text-body">${s.content}</div>
	      <div class="post-actions">
		<button class="action-btn comment-btn text-body">
		  <i class="bi bi-chat text-body"></i> ${s.comment_count} Comments
		</button>
		<button class="action-btn share-btn text-body">
		  <i class="bi bi-share text-body"></i> Share
		</button>
		<button class="action-btn save-btn text-body">
		  <i class="bi bi-bookmark text-body"></i> Save
		</button>
	      </div>
	    </div>
	  </div>
	`}function Ot(s){return`
    <div class="modal fade" id="commentsModal-${s}" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content bg-body text-body">
          <div class="modal-header border-secondary">
            <h5 class="modal-title">Comments</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            ${Tt(s)}
            <div class="comments-list mt-4">
              ${Lt(s)}
            </div>
          </div>
        </div>
      </div>
    </div>
  `}function Tt(s){return`
    <div class="comment-form bg-body text-body p-3 rounded">
      <form class="add-comment-form" data-post-id="${s}">
        <div class="form-group mb-3">
          <textarea class="form-control bg-body text-body" rows="3" placeholder="What are your thoughts?" required></textarea>
        </div>
        <div class="form-actions d-flex justify-content-end">
          <button type="submit" class="btn btn-primary">Comment</button>
        </div>
      </form>
    </div>
  `}function Lt(s){return`<div class="comments-list mt-4" id="comments-list-${s}"></div>`}async function nt(s){const l=document.querySelector(`#comments-list-${s}`);if(l){console.log(`Loading comments for post ${s}`),l.innerHTML='<div class="text-muted">Loading comments...</div>';try{const h=await fetch(`http://localhost:5000/api/comments/${s}`);if(!h.ok)throw new Error("Failed to fetch");const b=await h.json();if(console.log(b),!Array.isArray(b))throw new Error("Invalid format");const _=b.map(g=>`
      <div class="comment bg-body text-body p-3 mb-3 rounded border border-secondary" data-comment-id="${g.id}">
        <div class="d-flex">
          <img src="${g.avatar?"http://localhost:5000/"+g.avatar:"https://www.redditstatic.com/avatars/defaults/v2/avatar_default_4.png"}" 
            alt="${g.author}" 
            class="rounded-circle me-3" 
            width="32" 
            height="32">

          <div class="comment-body flex-grow-1">
            <div class="comment-header d-flex align-items-center mb-2">
              <span class="author fw-bold me-2">${g.username}</span>
              <span class="timestamp text-muted small">${J.utc(g.created_at).tz("Asia/Almaty").fromNow()}</span>
            </div>
            <div class="comment-content mb-2">${g.content}</div>
            <div class="comment-actions d-flex align-items-center">
              <button class="btn btn-sm btn-outline-secondary me-2 vote-btn upvote">
                <i class="bi bi-arrow-up"></i>
              </button>
              <span class="vote-count me-2">${g.total_votes}</span>
              <button class="btn btn-sm btn-outline-secondary me-3 vote-btn downvote">
                <i class="bi bi-arrow-down"></i>
              </button>
              <button class="btn btn-sm btn-link text-decoration-none">Reply</button>
            </div>
          </div>
        </div>
      </div>
    `).join("");l.innerHTML=_||'<div class="text-muted">No comments yet.</div>',Et()}catch(h){l.innerHTML='<div class="text-danger">Failed to load comments.</div>',console.error(h)}}}function Ct(s){document.querySelectorAll(`[data-target="#commentsModal-${s}"]`).forEach(l=>{l.addEventListener("click",()=>{nt(s)})}),document.querySelectorAll(`.add-comment-form[data-post-id="${s}"]`).forEach(l=>{l.addEventListener("submit",async h=>{h.preventDefault();const b=l.querySelector("textarea"),_=b.value.trim();if(_)try{if(!(await fetch(`http://localhost:5000/api/comments/${s}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${tt}`},body:JSON.stringify({content:_})})).ok)throw new Error("Failed to post comment");b.value="",await nt(s)}catch(g){console.error("Error posting comment:",g)}})})}function Et(s){document.querySelectorAll(".comment .vote-btn").forEach(l=>{l.addEventListener("click",async function(){const h=this.closest(".comment"),b=h.dataset.commentId,_=this.classList.contains("upvote"),g=this.classList.contains("downvote"),v=h.querySelector(".vote-count");let S=parseInt(v.textContent);const u=h.querySelector(".upvote"),f=h.querySelector(".downvote"),M=this.classList.contains("active");let $;M?$=0:_?$=1:g&&($=-1);try{const m=await fetch("http://localhost:5000/api/votes/comment",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${tt}`},body:JSON.stringify({commentId:b,vote:$})});if(!m.ok)throw new Error("Failed to update vote");const w=await m.json();u.classList.remove("active"),f.classList.remove("active"),M?S+=_?-1:1:(this.classList.add("active"),_?S+=f.classList.contains("active")?2:1:S-=u.classList.contains("active")?2:1),v.textContent=S}catch(m){console.error("Error updating comment vote:",m)}})})}const ct=document.getElementById("main");async function _t(){try{const s=await fetch("http://localhost:5000/api/threads",{method:"GET",credentials:"same-origin",headers:{Authorization:`Bearer ${tt}`}});if(s.ok){const l=await s.json();return console.log(l),l}else{const l=await s.json();return console.error("Error:",l.message||"Unknown error"),[]}}catch(s){return console.error("Network error:",s.message||"Unknown error"),[]}}async function kt(){try{const s=await _t();ct.innerHTML=St(s),zt()}catch(s){console.error("Error loading posts:",s),ct.innerHTML='<div class="alert alert-danger">Failed to load posts</div>'}}function zt(){document.querySelectorAll(".vote-btn").forEach(s=>{s.addEventListener("click",async function(){const l=this.closest(".post"),h=l.dataset.postId,b=this.classList.contains("upvote"),_=this.classList.contains("downvote"),g=l.querySelector(".vote-count");let v=parseInt(g.textContent);const S=l.querySelector(".upvote"),u=l.querySelector(".downvote"),f=this.classList.contains("active");let M;f?M=0:b?M=1:_&&(M=-1);try{const $=await fetch("http://localhost:5000/api/votes/thread",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${tt}`},body:JSON.stringify({threadId:h,vote:M})});if(!$.ok)throw new Error("Failed to update vote");const m=await $.json();S.classList.remove("active"),u.classList.remove("active"),f?v+=b?-1:1:(this.classList.add("active"),b?v+=u.classList.contains("active")?2:1:v-=S.classList.contains("active")?2:1),g.textContent=v}catch($){console.error("Error updating vote:",$)}})}),document.querySelectorAll(".comment-btn").forEach(s=>{s.addEventListener("click",async()=>{const l=s.closest(".post").dataset.postId;document.getElementById(`commentsModal-${l}`)||(document.body.insertAdjacentHTML("beforeend",Ot(l)),Ct(l)),await nt(l),new bootstrap.Modal(document.getElementById(`commentsModal-${l}`)).show()})})}document.addEventListener("DOMContentLoaded",kt);
